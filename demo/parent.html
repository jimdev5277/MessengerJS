<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="../messenger.js"></script>
</head>

<body>
  <h1>这是父页面</h1>
  <iframe id="iframe1" src="./child1.html" style="width:200px;height:200px"></iframe>
  <iframe id="iframe2" src="./child2.html" style="width:200px;height:200px"></iframe>
  <iframe id="iframe3" src="./child3.html" style="width:200px;height:200px"></iframe>
  <p>
    <input type="text" placeholder="输入消息" id="message" />
    <button type="button" class="btn btn-primary" onclick="sendMessage('iframe1');">send to iframe1</button>
    <button type="button" class="btn btn-primary" onclick="sendMessage('iframe2');">send to iframe2</button>
    <button type="button" class="btn btn-success" onclick="sendAll();">send to all</button>
    <button type="button" class="btn btn-success" onclick="sendJson();">send json to iframe3</button>
  </p>
  <pre id="output" class="alert alert-warning"></pre>
  <script>
    var messenger = new Messenger('Parent', 'projectName');
    iframe1 = document.getElementById('iframe1'),
      iframe2 = document.getElementById('iframe2'),
      iframe3 = document.getElementById('iframe3'),
      input = document.getElementById('message');
    messenger.listen(function(msg) {
      var newline = '\n';
      var text = document.createTextNode(msg + newline);
      document.getElementById('output').appendChild(text);
    });
    messenger.addTarget(iframe1.contentWindow, 'iframe1');
    messenger.addTarget(iframe2.contentWindow, 'iframe2');
    messenger.addTarget(iframe3.contentWindow, 'iframe3');

    function sendMessage(name) {
      var msg = input.value;
      messenger.targets[name].send("message from parent: " + msg);
      input.value = '';
    }

    function sendAll() {
      var msg = input.value;
      messenger.send("message from parent: " + msg);
      input.value = '';
    }

    function sendJson() {
      var dd = {
        wz: 'dd'
      };
      messenger.targets['iframe3'].send(JSON.stringify(dd));
    }
  </script>
</body>

</html>
